<!--
    流转卡查询打印
-->
<#include "../include/header.html" >
    <style>
        span[class='k-window-title'] {
            user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        .action_ok {
            color: #5fb760;
        }

        .action_dangerous {
            color: #eeac5f;
        }

        #mask2 {
            background-color: #434343;
            opacity: 0.5;
            filter: alpha(opacity=50);
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            z-index: 1001;
        }


    </style>
    <script type="text/javascript">
        var LODOP; //声明为全局变量
        var RESULT;


        /*   $(function(){
         setInterval(function(){
         $.ajax({
         url: '${base.contextPath}/test/form',
         async: false,
         success: function(data) {
         document.getElementById('s').innerHTML=JSON.stringify(data.rows[0]);
         document.getElementById('e').innerHTML=JSON.stringify(data.rows[1]);

         },
         });
         }, 1000);

         });*/


        //        function ajaxTest() {
        //            $.ajax({
        //                url: '${base.contextPath}/test/form',
        //                async: false,
        //                success: function (data) {
        //                    document.getElementById('s').innerHTML = JSON.stringify(data.rows[0]);
        //                    document.getElementById('e').innerHTML = JSON.stringify(data.rows[1]);
        //
        //                },
        //            });
        //        }

        var viewModel = kendo.observable({
            model: {},
            resetForm: function () {
                var formData = viewModel.model.toJSON();
                for (var k in formData) {
                    viewModel.model.set(k, null);
                }
                $('#Grid').data('kendoGrid').dataSource.read();
            },
            queryGrid: function (e) {
                $('#Grid').data('kendoGrid').dataSource.page(1);
            }


        });

    </script>


    <div id="content-container">
        <div id="page-content">
            <div class="panel" style="padding: 0px;border:none;box-shadow: none;">
                <form class="form-horizontal" id="myForm">
                    <div class="panel-body">
                        <div id="test">
                            <div class="row">
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">工厂</label>
                                        <div class="col-sm-8">
                                            <input id="queryType" class="k-textbox" data-bind="value:model.werks"
                                                   style="width: 100%">
                                        </div>

                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">产品物料号</label>
                                        <div class="col-sm-8">
                                            <input id="queryID" class="k-textbox" data-bind="value:model.matnr"
                                                   style="width: 100%">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">流转卡号</label>
                                        <div class="col-sm-8">
                                            <input type="text" style="width: 100%" data-bind="value:model.zpgdbar"
                                                   class="k-textbox">
                                        </div>
                                    </div>
                                </div>


                            </div>

                            <div class="row ">
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">订单</label>
                                        <div class="col-sm-8">
                                            <input type="text" style="width: 100%" data-bind="value:model.aufnr"
                                                   class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">流转卡状态</label>
                                        <div class="col-sm-8">
                                            <input id="finished" style="width: 100%" data-bind="value:model.status"
                                                   class="k-textbox">
                                        </div>

                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">订单类型</label>
                                        <div class="col-sm-8">
                                            <input type="text" style="width: 100%" data-bind="value:model.auart"
                                                   class="k-textbox">
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="rows">
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">打印标识</label>
                                        <div class="col-sm-8">
                                            <!--<input id="fabric" placeholder="Select fabric..." data-value-primitive="true" data-text-field="text" data-value-field="value"-->
                                            <!--data-bind="enabled: isEnabled, value:model.zdybs"/>-->
                                            <!--<script>-->
                                            <!--$(document).ready(function() {-->
                                            <!--// create ComboBox from input HTML element-->
                                            <!--$("#fabric").kendoComboBox({-->
                                            <!--dataTextField: "text",-->
                                            <!--dataValueField: "value",-->
                                            <!--dataSource: [-->
                                            <!--{ text: "包含全部", value: "ALL" },-->
                                            <!--{ text: "已打印", value: "Y" },-->
                                            <!--{ text: "未打印", value: "N" },-->
                                            <!--],-->
                                            <!--filter: "contains",-->
                                            <!--suggest: true,-->
                                            <!--});-->

                                            <!--var Ofabric = document.getElementById("fabric");-->
                                            <!--Ofabric.options[2].selected = true;-->
                                            <!--});-->
                                            <!--</script>-->
                                            <select class="mui-select" id="zdybs"
                                                    style="width: 200px;height: 30px;text-align: center;">
                                                <option value="ALL">包含全部</option>
                                                <option value="Y">已打印</option>
                                                <option value="N">未打印</option>
                                            </select>
                                            <script>
                                                $(document).ready(function () {
                                                    var Ozdybs = document.getElementById("zdybs");
                                                    Ozdybs.options[2].selected = true;
                                                    viewModel.model.zdybs = Ozdybs.options[2].value;
                                                });

                                                var Ozdybs = document.getElementById("zdybs");
                                                Ozdybs.onchange = function () {
                                                    if (Ozdybs.selectedIndex != 0) {
                                                        viewModel.model.zdybs = Ozdybs.options[Ozdybs.selectedIndex].value;
                                                    } else {
                                                        viewModel.model.zdybs = null;
                                                    }
                                                }
                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="margin-right: -8px;">
                            <!--<div class="pull-left" style="margin-right:15px;">-->
                            <!--<div style="margin-top: 6px"><font size="3">-->
                            <!--<div style="float: left">成功：</div>-->
                            <!--<div id="s" style="float: left;">0</div>-->
                            <!--<div style="float: left;margin-left: 20px">失败：</div>-->
                            <!--<div style="float: left" id="e">0</div>-->
                            <!--</font></div>-->
                            <!--</div>-->
                            <div class="pull-right" style="margin-right:15px">
                                <span class="btn btn-primary" data-bind="click:queryGrid"
                                      type="submit">
                                <i class="fa fa-search" style="margin-right:3px;"></i>
                            <@spring.message "hap.query"/></span>
                                <span class="btn btn-default" type="button" data-bind="click:resetForm">
                                <i class="fa fa-eraser" style="margin-right:3px;"></i>
                            <@spring.message "hap.reset"/></span>
                                <span class="btn btn-info" type="button" id="panel_hidden" onclick="test()">
                                <i class="fa fa-joomla" style="margin-right:3px;"></i>
                           <@spring.message "hap.panel_hidden"/></span>
                                <span class="btn btn-info" type="button" id="panel_show" onclick="test()"
                                      style="display: none">
                                <i class="fa fa-joomla" style="margin-right:3px;"></i>
                           <@spring.message "hap.panel_show"/></span>
                            </div>
                        </div>
                    </div>


                </form>
            </div>

            <div style="clear:both">
                <div id="Grid"></div>
            </div>

        </div>
    </div>
    <!--<div id="mask2">-->
    <!--</div>-->
    <input type="hidden" style="width: 100%" class="k-textbox" id="S1">
    <script type="text/javascript">

        //        var dMask2 = document.getElementById("mask2");
        //        dMask2.style.display = "none";//不显示遮罩

        kendo.bind($('#page-content'), viewModel);

        function test() {
            var apply = $("#test");
            var button_hidden = $("#panel_hidden");
            var button_show = $("#panel_show");
            if (apply.is(":hidden")) {
                button_hidden.show();
                button_show.hide();
                apply.show();    //如果元素为隐藏,则将它显现
            } else {
                button_hidden.hide();
                button_show.show();
                apply.hide();     //如果元素为显现,则将其隐藏
            }
            Hap.autoResizeGrid("#Grid");

        }

        var BaseUrl = _basePath;
        dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: BaseUrl + "/sap/cardh/queryAfterSort",
                    type: "POST",
                    dataType: "json"
                },
                parameterMap: function (options, type) {
                    if (type !== "read" && options.models) {
                        var datas = Hap.prepareSubmitParameter(options, type);

                        return kendo.stringify(datas);
                    } else if (type === "read") {
                        return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                    }
                }
            },
            batch: true,
            serverPaging: true,
            pageSize: 10,
            schema: {
                data: 'rows',
                total: 'total',
                model: {
                    id: "id",
                    fields: {
                        werks: {type: "string"},
                        matnr: {type: "string"},
                        aufnr: {type: "string"},
                        status: {type: "string"},
                        zpgdbar: {type: "string"},
                        auart: {type: "string"}

                    }
                }
            }
        });

        var gird = $("#Grid").kendoGrid({
            dataSource: dataSource,
            autoBind: false,
            height: '100%',
            resizable: true,
            scrollable: true,
            navigatable: false,
            selectable: 'rowbox,multiple',
            pageable: {
                pageSizes: [20, 50, 100, 500, 1000, 2000, 5000, "all"],
                refresh: true,
                buttonCount: 10
            },
            toolbar: [{
                name: "stop",
                template: '<span id="deleteBtn" class="btn btn-danger">删除工序流转卡</span>'
            },
                {
                    name: "print",
                    template: '<span id="printBtn" class="btn btn-success">打印工序流转卡</span>'
                }],
            columns: [
                {
                    field: "werks",
                    title: '工厂',
                    width: 70,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "matnr",
                    title: '物料编码',
                    width: 100,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "zpgdbar",
                    title: '流转卡号',
                    width: 140,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "zpgdbh",
                    title: '流转卡编号',
                    width: 70,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "zxhnum",
                    title: '箱号',
                    width: 70,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "shift",
                    title: '班次',
                    width: 70,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                },
                {
                    field: "status",
                    title: '流转卡当前状态',
                    width: 100,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "status2",
                    title: '流转卡上一状态',
                    width: 100,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "aufnr",
                    title: '生产订单',
                    width: 100,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "menge",
                    title: '流转卡数量',
                    width: 70,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "gamng",
                    title: '订单数量',
                    width: 70,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "gmein",
                    title: '单位',
                    width: 70,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "charg",
                    title: '日期序列',
                    width: 100,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "attr1",
                    title: '生产日期',
                    width: 100,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                },
                {
                    field: "gstrp",
                    title: '订单开始日期',
                    width: 100,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "gltrp",
                    title: '订单完成日期',
                    width: 100,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }, {
                    field: "zdybs",
                    title: '打印标识',
                    width: 70,
                    headerAttributes: {
                        style: "text-align: center;"
                    },
                    attributes: {
                        style: "text-align: center;"
                    }
                }

            ],
            editable: false
        });

        Hap.autoResizeGrid("#Grid");
    </script>
    <script>
        $('#S1').on('input', function () {
            RESULT = document.getElementById('S1').value;
            alert(RESULT);
        });
    </script>
    <script>
        $('#deleteBtn').on('click', function () {
            //检查记录是否勾选，检查勾选的记录的状态
            var grid = $("#Grid").data("kendoGrid"),
                selections = grid.selectedDataItems();
            var flg = " ";
            if (selections.length > 0) {
                for (var i = 0; i < selections.length; i++) {
                    if (selections[i].status != "CRTD" && selections[i].status != "PRNT") {
                        flg = "E";
                        kendo.ui.showErrorDialog({
                            title: '错误',
                            message: "选择的流转卡记录中包含已经报工的流转卡，不允许直接删除！"
                        });
                        break;
                    }
                }

                if (flg != "E") {
                    //开始删除逻辑
                    var dataarray = new Array();
                    for (var i = 0; i < selections.length; i++) {
                        var index = i;
                        var viewModeldel = kendo.observable({
                            model: {
                                zpgdbar: selections[index].zpgdbar,
                                zpgdbh: selections[index].zpgdbh,
                                zxhnum: selections[index].zxhnum,
                                werks: selections[index].werks,
                                matnr: selections[index].matnr,
                                aufnr: selections[index].aufnr,
                                auart: selections[index].auart,
                                menge: selections[index].menge,
                                gamng: selections[index].gamng,
                                gmein: selections[index].gmein,
                                charg: selections[index].charg,
                                gstrp: selections[index].gstrp,
                                gltrp: selections[index].gltrp,
                                aufpl: selections[index].aufpl,
                                status: selections[index].status,
                                status2: selections[index].status2
                            }
                        });
                        dataarray[i] = viewModeldel.model.toJSON();
                    }
                    var data = JSON.stringify(dataarray);
                    if (data.length > 0) {
                        kendo.ui.showConfirmDialog({
                            title: '提示',
                            message: '确定删除选中的流转卡及相关数据记录么?'
                        }).done(function (e) {
                            if (e.button == "OK") {
                                $.ajax({
                                    url: "${base.contextPath}/sap/cardh/deleteCardh",
                                    type: "POST",
                                    data: data,
                                    async: false,
                                    contentType: "application/json; charset=utf-8",
                                    success: function (res) {
                                        if (res.success) {
                                            $('#Grid').data('kendoGrid').dataSource.page(1);
                                            Hap.autoResizeGrid("#Grid");
                                            var message = res.message;
                                            kendo.ui.showConfirmDialog({
                                                title: '提示',
                                                message: message
                                            });
                                        } else {
                                            $('#Grid').data('kendoGrid').dataSource.page(1);
                                            Hap.autoResizeGrid("#Grid");
                                            var message = res.message;
                                            kendo.ui.showErrorDialog({
                                                title: '错误',
                                                message: message
                                            });
                                        }
                                    },
                                    error: function (res) {
                                        kendo.ui.showErrorDialog({
                                            title: '错误',
                                            message: "删除流转卡失败，请联系系统管理员！"
                                        });
                                    }
                                });
                            }
                        });
                    }
                }

            } else {
                kendo.ui.showErrorDialog({
                    title: '错误',
                    message: "请选择需要删除的流转卡记录！"
                });
            }
        });
        $('#printBtn').on('click', function () {
            //检查是否勾选记录

            var grid = $("#Grid").data("kendoGrid"),
                selections = grid.selectedDataItems();
            if (selections.length > 0) {

                try {
                    var LODOP = getLodop();
                    LODOP.PRINT_INITA("0mm", "0mm", "211.67mm", "317.5mm", "工序流转卡打印");
                    for (var i = 0; i < selections.length; i++) {
                        $.ajax({
                            url: "${base.contextPath}/sap/cardh/readyForPrintDL",
                            type: "get",
                            data: {
                                zpgdbar: selections[i].zpgdbar,
                                zpgdbh: selections[i].zpgdbh,
                                aufnr: selections[i].aufnr,
                                matnr: selections[i].matnr,
                                charg: selections[i].charg
                            },
                            async: false,
                            contentType: "application/json; charset=utf-8",
                            success: function (res) {
                                var rows = res.rows;
                                if (rows.length > 0) {
                                    var barcode = rows[0].zpgdbar;
                                    var mtlbd = rows[0].mtlbd;//铝材牌号
                                    var gamng = rows[0].gamng;//机加流转卡数量
                                    var plqty = rows[0].plqty;
                                    var aufnr = rows[0].aufnr;//压铸生产订单
                                    var matnr = rows[0].matnr;
                                    var maktx = rows[2].maktx;
                                    var auart = rows[0].auart;
                                    var shift = rows[0].shift;
                                    if (rows.length == 4) {
                                        var zxhbar = rows[3].zxhbar;
                                    } else {
                                        var zxhbar = "";
                                    }

                                    var printdate = getNowFormatDate();
                                    LODOP.ADD_PRINT_RECT("0.5mm", "1.01mm", "199.23mm", "285.01mm", 0, 3);
                                    LODOP.ADD_PRINT_LINE("40.3mm", "1.51mm", "40mm", "199.71mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("50.01mm", "1.51mm", "50.3mm", "200.21mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("1.01mm", "149.99mm", "70.01mm", "150.26mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("20.27mm", "1.51mm", "20mm", "149.52mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("30.27mm", "1.51mm", "30mm", "149.52mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("60.27mm", "1.51mm", "60.01mm", "199.5mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("20mm", "20mm", "70.01mm", "20.27mm", 0, 1);
                                    LODOP.ADD_PRINT_TEXT("4.23mm", "53.45mm", "44.19mm", "9.79mm", "工序流转卡");
                                    LODOP.SET_PRINT_STYLEA(0, "FontSize", 22);
                                    LODOP.SET_PRINT_STYLEA(0, "Bold", 1);
                                    LODOP.ADD_PRINT_TEXTA("T_werks", "22.49mm", "4.5mm", "12.44mm", "6.61mm", "工厂");
                                    LODOP.ADD_PRINT_TEXTA("V_ZPGDBAR", "13.76mm", "117.48mm", "30.96mm", "5.29mm", barcode);
                                    LODOP.ADD_PRINT_TEXT("13.49mm", "103.98mm", "12.96mm", "5.29mm", "卡号：");
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_LINE("20mm", "60.01mm", "40mm", "60.27mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("40mm", "80.01mm", "20mm", "80.27mm", 0, 1);
                                    LODOP.ADD_PRINT_TEXT("23.02mm", "62.18mm", "15.35mm", "5.29mm", "生产订单");
                                    LODOP.ADD_PRINT_TEXT("23.02mm", "110.86mm", "15.61mm", "5.29mm", "订单数量");
                                    LODOP.ADD_PRINT_LINE("40mm", "109.99mm", "20mm", "110.25mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("70.01mm", "124.99mm", "20mm", "125.25mm", 0, 1);
                                    if (auart.substring(0, 1) == "Y") {
                                        LODOP.ADD_PRINT_TEXT("32.01mm", "111.13mm", "15.88mm", "5.29mm", "标准装框");
                                    } else {
                                        LODOP.ADD_PRINT_TEXT("32.01mm", "111.13mm", "15.88mm", "5.29mm", "班产量");
                                    }
                                    LODOP.ADD_PRINT_TEXT("31.49mm", "61.91mm", "16.93mm", "5.29mm", "订单类型");
                                    LODOP.ADD_PRINT_TEXT("32.28mm", "3.44mm", "15.61mm", "5.29mm", "物料编码");
                                    LODOP.ADD_PRINT_TEXT("42.6mm", "2.65mm", "15.88mm", "5.29mm", "物料描述");
                                    LODOP.ADD_PRINT_TEXT("42.6mm", "128.59mm", "16.14mm", "5.29mm", "铝材牌号");
                                    LODOP.ADD_PRINT_TEXT("52.65mm", "127.79mm", "19.84mm", "5.29mm", "首工作中心");
                                    LODOP.ADD_PRINT_TEXT("52.39mm", "2.91mm", "15.88mm", "5.29mm", "打印日期");
                                    LODOP.ADD_PRINT_LINE("50.01mm", "60.01mm", "70.01mm", "60.27mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("50.01mm", "80.01mm", "70.01mm", "80.27mm", 0, 1);
                                    LODOP.ADD_PRINT_TEXT("52.65mm", "60.59mm", "22.49mm", "5.29mm", "计划完成日期");
                                    LODOP.ADD_PRINT_LINE("70.27mm", "1.51mm", "70.01mm", "199.5mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("80.27mm", "1.51mm", "80.01mm", "199.5mm", 0, 1);
                                    if (auart.substring(0, 1) == "Y") {
                                        LODOP.ADD_PRINT_TEXTA("modno", "62.44mm", "131.5mm", "9.26mm", "5.29mm", "模号");
                                        LODOP.ADD_PRINT_BARCODEA("ZXHBAR_CODE", "238.65mm", "83.61mm", "59mm", "39.42mm", "QRCode", zxhbar);
                                    } else {
                                        LODOP.ADD_PRINT_TEXTA("modno", "62.44mm", "131.5mm", "9.26mm", "5.29mm", "班组");
                                        LODOP.ADD_PRINT_TEXT("61.91mm", "153.99mm", "41.28mm", "5.29mm", shift);
                                    }


                                    LODOP.ADD_PRINT_TEXT("71.7mm", "77.52mm", "26.46mm", "6.61mm", "工序明细");
                                    LODOP.SET_PRINT_STYLEA(0, "FontSize", 11);
                                    LODOP.SET_PRINT_STYLEA(0, "Bold", 1);
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_LINE("90.28mm", "1.51mm", "90.01mm", "199.5mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("110.25mm", "1.51mm", "109.99mm", "199.5mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("130.25mm", "1.51mm", "129.99mm", "199.5mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("150.26mm", "1.51mm", "149.99mm", "199.5mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("170.26mm", "1.51mm", "169.99mm", "199.5mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("190.26mm", "1.51mm", "190mm", "199.5mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("210mm", "1.51mm", "210.26mm", "199.5mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("230mm", "1.51mm", "230.27mm", "199.5mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("80.01mm", "20mm", "286.01mm", "20.27mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("230mm", "40mm", "80.01mm", "40.27mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("80.01mm", "60.01mm", "230mm", "60.27mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("230mm", "80.01mm", "80.01mm", "80.27mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("230mm", "100.01mm", "80.01mm", "100.28mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("230mm", "119.99mm", "80.01mm", "120.25mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("230mm", "139.99mm", "80.01mm", "140.26mm", 0, 1);
                                    LODOP.ADD_PRINT_LINE("230mm", "180mm", "80.01mm", "180.26mm", 0, 1);
                                    LODOP.ADD_PRINT_TEXT("82.55mm", "1.85mm", "16.67mm", "5.29mm", "工序编号");
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_TEXT("82.81mm", "21.7mm", "17.2mm", "5.29mm", "工序名称");
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_TEXT("82.81mm", "43.92mm", "12.44mm", "5.29mm", "合格数");
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_TEXT("82.81mm", "63.24mm", "12.7mm", "5.29mm", "工废数");
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_TEXT("82.81mm", "83.08mm", "13.76mm", "5.29mm", "料废数");
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_TEXTA("erdat", "82.55mm", "102.39mm", "15.35mm", "6.61mm", "生产日期");
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_TEXT("83.34mm", "124.62mm", "9.79mm", "5.29mm", "班组");
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_TEXT("83.08mm", "145.52mm", "26.46mm", "5.29mm", "操作员");
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_TEXT("83.08mm", "183.89mm", "14.02mm", "5.29mm", "检验员");
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.ADD_PRINT_TEXT("241.56mm", "5.29mm", "9.26mm", "30.69mm", "箱号条码");
                                    LODOP.SET_PRINT_STYLEA(0, "FontSize", 14);
                                    LODOP.SET_PRINT_STYLEA(0, "Bold", 1);
                                    LODOP.SET_PRINT_STYLEA(0, "AlignJustify", 1);
                                    LODOP.SET_PRINT_STYLEA(0, "ItemType", 4);
                                    LODOP.ADD_PRINT_BARCODEA("ZPGDBAR_CODE", "3.44mm", "155.84mm", "59mm", "39.42mm", "QRCode", barcode);
                                    LODOP.SET_PRINT_STYLEA(0, "DataCharset", "UTF-8");

                                    LODOP.SET_PRINT_STYLEA(0, "DataCharset", "UTF-8");
                                    LODOP.ADD_PRINT_TEXTA("V_WERKS", "22.75mm", "21.7mm", "37.31mm", "5.29mm", "重庆渝江压铸");
                                    LODOP.ADD_PRINT_TEXTA("V_AUFNR", "22.49mm", "81.23mm", "26.46mm", "5.29mm", aufnr);
                                    LODOP.ADD_PRINT_TEXTA("V_AUART", "32.54mm", "81.49mm", "26.46mm", "5.29mm", auart);
                                    LODOP.ADD_PRINT_TEXTA("V_GAMNG", "23.02mm", "128.85mm", "19.84mm", "5.29mm", gamng);
                                    LODOP.ADD_PRINT_TEXTA("V_PLQTY", "32.28mm", "127.79mm", "21.17mm", "5.29mm", plqty);
                                    LODOP.ADD_PRINT_TEXTA("V_MTLBD", "43.13mm", "151.87mm", "45.24mm", "5.29mm", mtlbd);
                                    LODOP.ADD_PRINT_TEXTA("V_MATNR", "32.81mm", "21.17mm", "37.57mm", "5.29mm", matnr);
                                    LODOP.ADD_PRINT_TEXT("42.6mm", "21.96mm", "102.39mm", "5.29mm", maktx);
                                    LODOP.ADD_PRINT_TEXT("52.39mm", "23.55mm", "26.46mm", "5.29mm", printdate);
                                    if (auart.substring(0, 1) == "Y") {
                                        LODOP.ADD_PRINT_TEXT("52.12mm", "83.61mm", "26.46mm", "5.29mm", rows[0].gltrp);
                                    } else {
                                        LODOP.ADD_PRINT_TEXT("52.12mm", "83.61mm", "26.46mm", "5.29mm", rows[0].attr1);
                                    }


                                    LODOP.ADD_PRINT_TEXT("62.44mm", "2.91mm", "16.93mm", "5.29mm", "铝液批次");
                                    LODOP.ADD_PRINT_TEXT("62.18mm", "61.65mm", "17.2mm", "5.29mm", "熔炼炉号");
                                    LODOP.ADD_PRINT_TEXTA("zxhbar", "274.9mm", "81.23mm", "42.86mm", "5.29mm", zxhbar);


                                    var num = 0;
                                    var cardt = rows[1];
                                    for (var j = 0; j < cardt.length; j++) {
                                        if (j == 0) {
                                            LODOP.ADD_PRINT_TEXTA("row1_vonor", "95.28mm", "5mm", "12.7mm", "5.29mm", cardt[j].vornr);
                                            LODOP.ADD_PRINT_TEXT("95.01mm", "21.99mm", "15.88mm", "12.44mm", cardt[j].ltxa1+"("+cardt[j].steus +")");
                                            //LODOP.ADD_PRINT_TEXT("92.34mm","140.76mm","37.31mm","15.08mm",cardt[j].ktext);
                                            LODOP.ADD_PRINT_TEXT("50.54mm", "150.28mm", "46.83mm", "9.53mm", cardt[j].ktext);

                                        } else if (j == 1) {
                                            LODOP.ADD_PRINT_TEXTA("row2_vonor", "116.05mm", "5mm", "12.7mm", "5.29mm", cardt[j].vornr);
                                            LODOP.ADD_PRINT_TEXT("114.99mm", "21.99mm", "15.88mm", "12.17mm", cardt[j].ltxa1+"("+cardt[j].steus +")");
                                            //LODOP.ADD_PRINT_TEXT("112.45mm","141.55mm","37.31mm","15.08mm",cardt[j].ktext);
                                        } else if (j == 2) {
                                            LODOP.ADD_PRINT_TEXTA("row3_vornr", "135.26mm", "5mm", "12.7mm", "5.29mm", cardt[j].vornr);
                                            LODOP.ADD_PRINT_TEXT("133.14mm", "21.43mm", "15.88mm", "13.23mm", cardt[j].ltxa1+"("+cardt[j].steus +")");
                                            //LODOP.ADD_PRINT_TEXT("133.09mm","141.55mm","37.31mm","15.08mm",cardt[j].ktext);
                                        } else if (j == 3) {
                                            LODOP.ADD_PRINT_TEXTA("row4_vornr", "154.46mm", "5mm", "12.7mm", "5.29mm", cardt[j].vornr);
                                            LODOP.ADD_PRINT_TEXT("154.99mm", "21.99mm", "15.88mm", "13.23mm", cardt[j].ltxa1+"("+cardt[j].steus +")");
                                            // LODOP.ADD_PRINT_TEXT("152.4mm","141.55mm","37.31mm","15.08mm",cardt[j].ktext);
                                        } else if (j == 4) {
                                            LODOP.ADD_PRINT_TEXT("175mm", "5mm", "12.7mm", "5.29mm", cardt[j].vornr);
                                            LODOP.ADD_PRINT_TEXT("175mm", "21.99mm", "15.88mm", "13.23mm", cardt[j].ltxa1+"("+cardt[j].steus +")");
                                            //LODOP.ADD_PRINT_TEXT("172.77mm","141.82mm","37.31mm","15.08mm",cardt[j].ktext);
                                        } else if (j == 5) {
                                            LODOP.ADD_PRINT_TEXT("195mm", "5mm", "12.7mm", "5.29mm", cardt[j].vornr);
                                            LODOP.ADD_PRINT_TEXT("193.68mm", "21.99mm", "15.88mm", "13.23mm", cardt[j].ltxa1+"("+cardt[j].steus +")");
                                            //LODOP.ADD_PRINT_TEXT("192.35mm","141.02mm","37.31mm","15.08mm",cardt[j].ktext);
                                        } else if (j == 6) {
                                            LODOP.ADD_PRINT_TEXT("215mm", "5mm", "12.7mm", "5.29mm", cardt[j].vornr);
                                            LODOP.ADD_PRINT_TEXT("213.68mm", "21.99mm", "15.88mm", "13.23mm", cardt[j].ltxa1+"("+cardt[j].steus +")");
                                            //LODOP.ADD_PRINT_TEXT("211.93mm","141.02mm","37.31mm","15.08mm",cardt[j].ktext);
                                        }
                                    }
                                }
                            }
                        });

                        if (selections.length > 1 && i != selections - 1) {
                            LODOP.NEWPAGE();

                        }

                    }
                    tempprint();
                    dMask2.style.display = "";//添加遮罩

                } catch (err) {

                }

            } else {
                kendo.ui.showErrorDialog({
                    title: '错误',
                    message: "请选择需要打印的流转卡记录！"
                });
            }
        });

        function tempprint() {//打印回调

            if (LODOP.CVERSION) CLODOP.On_Return = function (TaskID, Value) {
                document.getElementById('S1').value = Value;
                if (Value == 1 || Value == 0) {
                    //dMask2.style.display = "none";
                    //反写打印标识和修改打印状态

                    if (Value == 1) {//成功打印
                        var dataarray = new Array();
                        var grid = $("#Grid").data("kendoGrid"),
                            selections = grid.selectedDataItems();
                        if (selections.length > 0) {
                            for (var i = 0; i < selections.length; i++) {
                                var index = i;
                                var viewModelupdate = kendo.observable({
                                    model: {
                                        zpgdbar: selections[index].zpgdbar,
                                        status: "PRNT",
                                        isactive: "X"
                                    }
                                });
                                dataarray[i] = viewModelupdate.model.toJSON();
                            }
                            var data = JSON.stringify(dataarray);
                            $.ajax({
                                url: "${base.contextPath}/sap/cardhst/updateStatus",
                                type: "POST",
                                data: data,
                                async: false,
                                contentType: "application/json; charset=utf-8",
                                success: function (res) {
                                    if (res.code == 'S') {
                                        $('#Grid').data('kendoGrid').dataSource.page(1);
                                        Hap.autoResizeGrid("#Grid");
                                        dMask2.style.display = "none";
                                    } else {
                                        $('#Grid').data('kendoGrid').dataSource.page(1);
                                        Hap.autoResizeGrid("#Grid");
                                        dMask2.style.display = "none";
                                        kendo.ui.showErrorDialog({
                                            title: '错误',
                                            message: res.message
                                        });
                                    }
                                }
                            });
                        }

                    } else {
                        //取消打印 不做处理
                        dMask2.style.display = "none";
                    }
                }

            };
            LODOP.SET_PREVIEW_WINDOW(0, 1, 1, 1024, 768, "自定义标题.开始打印");
            document.getElementById('S1').value = LODOP.PREVIEW();
            //document.getElementById('S1').value= LODOP.PRINT_DESIGN();

        }

        function getNowFormatDate() {
            var date = new Date();
            var seperator1 = "-";
            var seperator2 = ":";
            var month = date.getMonth() + 1;
            var strDate = date.getDate();
            if (month >= 1 && month <= 9) {
                month = "0" + month;
            }
            if (strDate >= 0 && strDate <= 9) {
                strDate = "0" + strDate;
            }
            var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
                + " " + date.getHours() + seperator2 + date.getMinutes()
                + seperator2 + date.getSeconds();
            return currentdate;
        }
    </script>

    </body>
    </html>